<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿˜å¹´ä¼š ã‚¯ãƒ­ã‚¹BINGO</title>
    <style>
        /* å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            background-color: #f7f7f7;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 16px;
            box-sizing: border-box;
        }

        .container {
            width: 100%;
            max-width: 500px;
            margin: auto;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            font-size: 1.8rem; /* ã‚¹ãƒãƒ›å‘ã‘ã«å¤§ãã */
            margin-bottom: 16px;
        }

        .rules {
            background-color: #ffffff;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .rules h2 {
            font-size: 1.2rem; /* ã‚¹ãƒãƒ›å‘ã‘ã«å¤§ãã */
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 12px;
        }

        .rules ul {
            margin: 0;
            padding-left: 20px;
            font-size: 1rem; /* ã‚¹ãƒãƒ›å‘ã‘ã«å¤§ãã */
            color: #555;
            line-height: 1.6;
        }

        .rules li {
            margin-bottom: 6px;
        }

        .rules .notice {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 14px;
            margin-top: 12px;
            border-radius: 4px;
            font-size: 0.95rem; /* ã‚¹ãƒãƒ›å‘ã‘ã«å¤§ãã */
            color: #856404;
            line-height: 1.6;
        }

        .rules .notice strong {
            font-size: 1.05rem;
        }

        /* BINGOãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .bingo-card {
            width: 100%;
            border-collapse: collapse;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            overflow: hidden;
        }

        .bingo-card td {
            width: 33.33%;
            padding-top: 33.33%;
            position: relative;
            border: 3px solid #f7f7f7;
            background-color: #ffffff;
            user-select: none;
            /* é”æˆæ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
            transition: background-color 0.3s;
        }

        /* é”æˆã—ãŸãƒã‚¹ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .bingo-card td.achieved {
            background-color: #ff9800; /* ã‚ªãƒ¬ãƒ³ã‚¸è‰² */
        }


        /* ãƒã‚¹ã®ä¸­èº«(ãƒ†ã‚­ã‚¹ãƒˆ)ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .cell-content {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            display: flex;
            /* è¦ç´ ã‚’ç¸¦ã«ä¸¦ã¹ã‚‹ */
            flex-direction: column;
            justify-content: flex-start; /* ä¸Šéƒ¨ã‹ã‚‰é…ç½® */
            align-items: center;
            padding: 10px 8px;
            box-sizing: border-box;
            cursor: default; /* ã‚¯ãƒªãƒƒã‚¯ä¸å¯ã«ã™ã‚‹ */
            text-align: center;
            overflow: hidden; /* ã¯ã¿å‡ºã—ã‚’é˜²ã */
        }

        /* ãŠé¡Œã®ãƒ†ã‚­ã‚¹ãƒˆ */
        .task {
            font-size: 1.1rem; /* ã‚¹ãƒãƒ›å‘ã‘ã«å¤§ãã */
            font-weight: bold;
            color: #333;
            line-height: 1.4;
            text-align: center;
            width: 100%;
            display: block; /* ãƒ–ãƒ­ãƒƒã‚¯è¦ç´ ã¨ã—ã¦è¡¨ç¤ºï¼ˆHTMLã‚¿ã‚°å¯¾å¿œï¼‰ */
            padding: 4px 0;
            flex: 1; /* åˆ©ç”¨å¯èƒ½ãªã‚¹ãƒšãƒ¼ã‚¹ã‚’æœ€å¤§é™ä½¿ç”¨ */
            overflow-wrap: break-word; /* è‡ªå‹•æŠ˜ã‚Šè¿”ã— */
            word-wrap: break-word; /* è‡ªå‹•æŠ˜ã‚Šè¿”ã—ï¼ˆæ—§ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œï¼‰ */
            word-break: break-word; /* é•·ã„å˜èªã‚‚æ”¹è¡Œ */
        }
        
        /* é”æˆæ™‚ã®ãŠé¡Œãƒ†ã‚­ã‚¹ãƒˆ */
        .achieved .task {
            color: #fff;
            text-decoration: line-through;
        }

        /* å…¥åŠ›ã‚¨ãƒªã‚¢ï¼ˆéè¡¨ç¤º - ãƒ¢ãƒ¼ãƒ€ãƒ«ã§å…¥åŠ›ï¼‰ */
        .input-area {
            display: none;
        }

        /* ãƒã‚¹ã‚¯ãƒªãƒƒã‚¯æ™‚ã«ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã‚’è¡¨ç¤º */
        .bingo-card td {
            cursor: pointer;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚° */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes zoomIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .modal-content {
            background-color: #ffffff;
            padding: 24px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            animation: zoomIn 0.3s;
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.3rem;
            color: #2c3e50;
            text-align: center;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-input {
            width: 100%;
            font-size: 1.1rem; /* ã‚¹ãƒãƒ›å‘ã‘ã«å¤§ãã */
            padding: 12px;
            margin-bottom: 16px;
            box-sizing: border-box;
            border: 2px solid #ccc;
            border-radius: 8px;
            text-align: center;
        }

        .modal-input:focus {
            outline: none;
            border-color: #3498db;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
        }

        .modal-btn {
            flex: 1;
            font-size: 1.1rem;
            font-weight: bold;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .modal-btn-primary {
            background-color: #3498db;
            color: white;
        }

        .modal-btn-primary:active {
            background-color: #2980b9;
        }

        .modal-btn-secondary {
            background-color: #95a5a6;
            color: white;
        }

        .modal-btn-secondary:active {
            background-color: #7f8c8d;
        }
        
        /* é”æˆå¾Œï¼šå…¥åŠ›ã•ã‚ŒãŸåå‰ã‚’è¡¨ç¤º */
        .achieved-name {
            display: none; /* é€šå¸¸ã¯éè¡¨ç¤º */
            font-size: 1rem; /* ã‚¹ãƒãƒ›å‘ã‘ã«å¤§ãã */
            font-weight: bold;
            color: #ffffff;
            word-break: break-all; /* åå‰ãŒé•·ãã¦ã‚‚æ”¹è¡Œ */
            line-height: 1.4;
            flex-shrink: 0; /* ç¸®å°ã—ãªã„ */
            position: absolute;
            bottom: 8px;
            left: 0;
            right: 0;
            padding: 0 8px;
            text-align: center;
        }
        
        .achieved .achieved-name {
            display: block; /* é”æˆã—ãŸã‚‰è¡¨ç¤º */
        }
        
        /* æœªå…¥åŠ›æ™‚ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ */
        .input-placeholder {
            display: block;
            font-size: 1.2rem; /* å¤§ãã */
            color: #999; /* ç°è‰² */
            font-weight: normal;
            margin-top: auto; /* ä¸‹éƒ¨ã«é…ç½® */
            padding-top: 8px;
            text-align: center;
            cursor: pointer;
            position: absolute;
            bottom: 8px;
            left: 0;
            right: 0;
        }
        
        .achieved .input-placeholder {
            display: none; /* é”æˆæ™‚ã¯éè¡¨ç¤º */
        }
        
        /* é”æˆæ™‚ã¯ãŠé¡Œã‚¨ãƒªã‚¢ã‚’ç¸®å° */
        .achieved .task {
            flex: 1; /* é”æˆæ™‚ã‚‚ãŠé¡Œã‚¨ãƒªã‚¢ã‚’ä½¿ç”¨ */
            max-height: none; /* åˆ¶é™ãªã— */
            overflow: hidden;
        }

        /* ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ */
        .login-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background-color: #ffffff;
            border-radius: 12px;
            padding: 32px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .login-box h2 {
            margin-top: 0;
            margin-bottom: 24px;
            font-size: 1.5rem;
            color: #2c3e50;
            text-align: center;
        }

        .login-input {
            width: 100%;
            font-size: 1.1rem;
            padding: 12px;
            margin-bottom: 16px;
            box-sizing: border-box;
            border: 2px solid #ccc;
            border-radius: 8px;
            text-align: center;
        }

        .login-input:focus {
            outline: none;
            border-color: #3498db;
        }

        .login-btn {
            width: 100%;
            font-size: 1.1rem;
            font-weight: bold;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background-color: #3498db;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .login-btn:hover {
            background-color: #2980b9;
        }

        .login-btn:active {
            background-color: #21618c;
        }

        .login-error {
            color: #e74c3c;
            font-size: 0.9rem;
            margin-top: 8px;
            text-align: center;
            display: none;
        }

        .login-error.show {
            display: block;
        }

        /* èªè¨¼æ¸ˆã¿ã®å ´åˆã®ã¿BINGOã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º */
        .bingo-content {
            display: none;
        }

        .bingo-content.authenticated {
            display: block;
        }

    </style>
</head>
<body>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <h2>å¿˜å¹´ä¼š ã‚¯ãƒ­ã‚¹BINGO</h2>
            <input type="password" id="passwordInput" class="login-input" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" autofocus>
            <button class="login-btn" onclick="handleLogin()">ãƒ­ã‚°ã‚¤ãƒ³</button>
            <div id="loginError" class="login-error">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“</div>
        </div>
    </div>

    <!-- BINGOã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div id="bingoContent" class="bingo-content">
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h1 style="margin: 0;">å¿˜å¹´ä¼š ã‚¯ãƒ­ã‚¹BINGO</h1>
            <button onclick="handleLogout()" style="padding: 8px 16px; background-color: #95a5a6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
        
        <div class="rules">
            <h2>ğŸ® ãƒ«ãƒ¼ãƒ«èª¬æ˜</h2>
            <ul>
                <li>å„ãƒã‚¹ã«è¡¨ç¤ºã•ã‚ŒãŸãŠé¡Œã‚’é”æˆã—ãŸäººã‚’æ¢ã—ã¾ã—ã‚‡ã†</li>
                <li>ãƒã‚¹ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã€é”æˆã—ãŸäººã®ä¼šç¤¾åã¨åå‰ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ãƒã‚¹ãŒã‚ªãƒ¬ãƒ³ã‚¸è‰²ã«å¤‰ã‚ã‚Šã¾ã™</li>
                <li>ç¸¦ãƒ»æ¨ªãƒ»æ–œã‚ã®ã„ãšã‚Œã‹1åˆ—ãŒæƒã£ãŸã‚‰ã€ŒBINGOï¼ã€ã§ã™</li>
                <li>ä¸­å¤®ã®ãƒã‚¹ã¯ã€Œã‚¢ãƒ€ã‚¹ãƒˆãƒªã‚¢ãƒ–ãƒ©ãƒ³ãƒ‰ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’èº«ã«ç€ã‘ã¦ã„ã‚‹ã€ã§å›ºå®šã§ã™</li>
            </ul>
            <div class="notice">
                <strong>âš ï¸ ã”æ³¨æ„</strong><br>
                ãƒ“ãƒ³ã‚´å½“é¸å¾Œã«å„ãƒã‚¹ã®å†…å®¹ã¨æ›¸ã‹ã‚ŒãŸäººã®åå‰ã‚’èª­ã¿ä¸Šã’ã¦æ™¯å“ã‚’ã‚ãŸã™ã®ã§ã€åå‰ã‚’æ›¸ã‹ã‚Œã‚‹ã“ã¨ã®æ‰¿èªã‚’æœ¬äººã‹ã‚‰å¾—ã¦ãã ã•ã„ã€‚
            </div>
        </div>
        
        <table class="bingo-card">
            <!-- JavaScriptã§ <tbody> ã®ä¸­èº«ãŒç”Ÿæˆã•ã‚Œã¾ã™ -->
            <tbody id="bingo-body">
                <!-- 
                â†“ JavaScriptã«ã‚ˆã£ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹é€ ãŒãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã•ã‚Œã¾ã™
                <tr>
                    <td>
                        <div class="cell-content">
                            <div class="task">ãŠé¡Œãƒ†ã‚­ã‚¹ãƒˆ</div>
                            <div class="input-area">
                                <input type="text" placeholder="åå‰" class="name-input">
                                <button class="submit-btn">OK</button>
                            </div>
                            <div class="achieved-name"></div>
                        </div>
                    </td>
                    ...
                </tr> 
                -->
            </tbody>
        </table>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->
    <div id="inputModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTask"></h3>
            </div>
            <div class="modal-body">
                <input type="text" id="modalCompanyInput" class="modal-input" placeholder="ä¼šç¤¾å" autofocus>
                <input type="text" id="modalNameInput" class="modal-input" placeholder="åå‰">
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-secondary" onclick="closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="modal-btn modal-btn-primary" onclick="submitModal()">OK</button>
            </div>
        </div>
    </div>
    </div>

    <script>
        // èªè¨¼çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
        const AUTH_KEY = 'bingo_authenticated';
        
        // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã™ã‚‹æ³¨æ„ï¼š
        // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®JavaScriptã§ã¯å®Œå…¨ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¯ä¿è¨¼ã§ãã¾ã›ã‚“ã€‚
        // ãƒãƒƒã‚·ãƒ¥å€¤ã¯ã‚³ãƒ¼ãƒ‰å†…ã«å«ã¾ã‚Œã¾ã™ãŒã€å¹³æ–‡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å«ã¾ã‚Œã¾ã›ã‚“ã€‚
        // ã‚ˆã‚Šå¼·å›ºãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒå¿…è¦ãªå ´åˆã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰èªè¨¼ã®å®Ÿè£…ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚
        
        // ã‚½ãƒ«ãƒˆï¼ˆãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—åˆ—ï¼‰- ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«æ”»æ’ƒã‚’é˜²ã
        const SALT = 'bingo_salt_2024_adastria';
        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®SHA-256ãƒãƒƒã‚·ãƒ¥å€¤ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: bounenkai2024ï¼‰
        // è¨ˆç®—æ–¹æ³•: SHA-256(SALT + 'bounenkai2024')
        const PASSWORD_HASH = '7d9d9c98d8f339e664f077839bfc5dda8a31152511293c5d7b938cea036d4a68';

        // æ–‡å­—åˆ—ã‚’SHA-256ãƒãƒƒã‚·ãƒ¥ã«å¤‰æ›
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }
        
        // ã‚½ãƒ«ãƒˆä»˜ããƒãƒƒã‚·ãƒ¥ã‚’è¨ˆç®—
        async function hashWithSalt(password) {
            return await sha256(SALT + password);
        }

        // èªè¨¼çŠ¶æ…‹ã‚’ç¢ºèª
        function checkAuth() {
            return localStorage.getItem(AUTH_KEY) === 'true';
        }

        // èªè¨¼çŠ¶æ…‹ã‚’ä¿å­˜
        function setAuth(authenticated) {
            if (authenticated) {
                localStorage.setItem(AUTH_KEY, 'true');
            } else {
                localStorage.removeItem(AUTH_KEY);
            }
        }

        // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
        async function handleLogin() {
            const passwordInput = document.getElementById('passwordInput');
            const loginError = document.getElementById('loginError');
            const password = passwordInput.value.trim();

            if (!password) {
                loginError.classList.add('show');
                return;
            }

            // å…¥åŠ›ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚½ãƒ«ãƒˆä»˜ãã§ãƒãƒƒã‚·ãƒ¥åŒ–
            const passwordHash = await hashWithSalt(password);

            // ãƒãƒƒã‚·ãƒ¥å€¤ã‚’æ¯”è¼ƒ
            if (passwordHash === PASSWORD_HASH) {
                setAuth(true);
                showBingoContent();
            } else {
                loginError.classList.add('show');
                passwordInput.value = '';
                setTimeout(() => {
                    loginError.classList.remove('show');
                }, 3000);
            }
        }

        // BINGOã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
        function showBingoContent() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('bingoContent').classList.add('authenticated');
        }

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
        function handleLogout() {
            setAuth(false);
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('bingoContent').classList.remove('authenticated');
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordInput').focus();
        }

        // Enterã‚­ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('passwordInput');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        handleLogin();
                    }
                });
            }

            // èªè¨¼çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
            if (checkAuth()) {
                showBingoContent();
            }
        });

        // DOMï¼ˆHTMLï¼‰ã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ãŸã‚‰å®Ÿè¡Œ
        document.addEventListener('DOMContentLoaded', async function() {
            // èªè¨¼ã•ã‚Œã¦ã„ãªã„å ´åˆã¯å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
            if (!checkAuth()) {
                return;
            }
            
            // ãƒ†ã‚­ã‚¹ãƒˆã‚’è‡ªå‹•æ”¹è¡Œã™ã‚‹é–¢æ•°ï¼ˆé•·ã„ãƒ†ã‚­ã‚¹ãƒˆã‚’é©åˆ‡ãªä½ç½®ã§æ”¹è¡Œï¼‰
            function autoWrapText(text) {
                if (!text || text.length === 0) return '';
                
                // æ”¹è¡Œã‚¿ã‚°ã‚’å‰Šé™¤ã—ã¦ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã«ã™ã‚‹
                const cleanText = text.replace(/<br>/gi, '').trim();
                
                // çŸ­ã„ãƒ†ã‚­ã‚¹ãƒˆï¼ˆ10æ–‡å­—ä»¥ä¸‹ï¼‰ã¯ãã®ã¾ã¾è¿”ã™
                if (cleanText.length <= 10) {
                    return cleanText;
                }
                
                // é•·ã„ãƒ†ã‚­ã‚¹ãƒˆã®å ´åˆã€é©åˆ‡ãªä½ç½®ã§æ”¹è¡Œã‚’æŒ¿å…¥
                // æ‹¬å¼§ãŒã‚ã‚‹å ´åˆã¯æ‹¬å¼§ã®å¾Œã§æ”¹è¡Œ
                const parenMatch = cleanText.match(/ï¼ˆ[^ï¼‰]+ï¼‰/);
                if (parenMatch && cleanText.length > 12) {
                    const parenIndex = cleanText.indexOf('ï¼‰');
                    if (parenIndex > 0 && parenIndex < cleanText.length - 3) {
                        return cleanText.substring(0, parenIndex + 1) + '<br>' + cleanText.substring(parenIndex + 1);
                    }
                }
                
                // å¥èª­ç‚¹ãŒã‚ã‚‹å ´åˆã¯å¥èª­ç‚¹ã®å¾Œã§æ”¹è¡Œ
                const punctuationMatch = cleanText.match(/[ã€ã€‚ï¼Œï¼]/);
                if (punctuationMatch && cleanText.length > 12) {
                    const punctIndex = cleanText.indexOf(punctuationMatch[0]);
                    if (punctIndex > 0 && punctIndex < cleanText.length - 3) {
                        return cleanText.substring(0, punctIndex + 1) + '<br>' + cleanText.substring(punctIndex + 1);
                    }
                }
                
                // åŒºåˆ‡ã‚Šæ–‡å­—ãŒãªã„å ´åˆã¯æ–‡å­—æ•°ã§åˆ¤æ–­ï¼ˆ12æ–‡å­—ç¨‹åº¦ã§æ”¹è¡Œï¼‰
                if (cleanText.length > 12) {
                    // ä¸­ç‚¹ã‚’æ¢ã™
                    const midPoint = Math.floor(cleanText.length / 2);
                    const midDotIndex = cleanText.indexOf('ãƒ»', midPoint - 3);
                    if (midDotIndex > 0) {
                        return cleanText.substring(0, midDotIndex + 1) + '<br>' + cleanText.substring(midDotIndex + 1);
                    }
                    // ä¸­ç‚¹ãŒãªã„å ´åˆã¯ä¸­å¤®ä»˜è¿‘ã§æ”¹è¡Œ
                    return cleanText.substring(0, midPoint) + '<br>' + cleanText.substring(midPoint);
                }
                
                return cleanText;
            }
            
            // 1. CSVãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãŠé¡Œãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚€
            let tasks = [];
            try {
                const response = await fetch('tasks.csv');
                if (!response.ok) {
                    throw new Error('CSVãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                const csvText = await response.text();
                // CSVã‚’1è¡Œ1ãŠé¡Œã¨ã—ã¦èª­ã¿è¾¼ã‚€ï¼ˆç©ºè¡Œã‚’ç„¡è¦–ï¼‰
                const rawTasks = csvText.split('\n')
                    .map(line => line.trim())
                    .filter(line => line.length > 0);
                
                // ãŠé¡Œã¯ãã®ã¾ã¾ä½¿ç”¨ï¼ˆCSSã§è‡ªå‹•æŠ˜ã‚Šè¿”ã—ï¼‰
                tasks = rawTasks.filter(task => task.length > 0);
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãŠé¡Œï¼ˆCSVãŒèª­ã¿è¾¼ã‚ãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
                if (tasks.length === 0) {
                    const defaultTasks = [
                        "ã‚´ãƒ«ãƒ•ãŒè¶£å‘³",
                        "ã‚µã‚¦ãƒŠãŒå¥½ã",
                        "å‹¤ç¶š20å¹´ä»¥ä¸Š",
                        "é‡£ã‚ŠãŒå¥½ã",
                        "å¾¡ç¤¾ï¼ˆãƒ›ã‚¹ãƒˆä¼æ¥­ï¼‰ã¨ä¸€ç•ªä»˜ãåˆã„ãŒé•·ã„",
                        "å‡ºèº«åœ°ãŒä¹å·",
                        "æœ€è¿‘å­«ãŒç”Ÿã¾ã‚ŒãŸ",
                        "ãƒ©ãƒ¼ãƒ¡ãƒ³ãŒé€±3ä»¥ä¸Šã§å¥½ã",
                        "æ„›å¦»å®¶ã‚’è‡ªèªã—ã¦ã„ã‚‹"
                    ];
                    tasks = defaultTasks;
                }
            } catch (error) {
                console.error('CSVèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãŠé¡Œã‚’ä½¿ç”¨ï¼ˆè‡ªå‹•æ”¹è¡Œå‡¦ç†ã‚‚é©ç”¨ï¼‰
                const defaultTasks = [
                    "ã‚´ãƒ«ãƒ•ãŒè¶£å‘³",
                    "ã‚µã‚¦ãƒŠãŒå¥½ã",
                    "å‹¤ç¶š20å¹´ä»¥ä¸Š",
                    "é‡£ã‚ŠãŒå¥½ã",
                    "å¾¡ç¤¾ï¼ˆãƒ›ã‚¹ãƒˆä¼æ¥­ï¼‰ã¨ä¸€ç•ªä»˜ãåˆã„ãŒé•·ã„",
                    "å‡ºèº«åœ°ãŒä¹å·",
                    "æœ€è¿‘å­«ãŒç”Ÿã¾ã‚ŒãŸ",
                    "ãƒ©ãƒ¼ãƒ¡ãƒ³ãŒé€±3ä»¥ä¸Šã§å¥½ã",
                    "æ„›å¦»å®¶ã‚’è‡ªèªã—ã¦ã„ã‚‹"
                ];
                tasks = defaultTasks;
            }

            // 2. ãŠé¡Œã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã™ã‚‹ï¼ˆFisher-Yatesã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼‰
            function shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // 3. BINGOã‚«ãƒ¼ãƒ‰ã‚’HTMLã¨ã—ã¦ç”Ÿæˆã™ã‚‹
            function createBingoCard() {
                const tbody = document.getElementById('bingo-body');
                tbody.innerHTML = ''; // ä¸­èº«ã‚’ãƒªã‚»ãƒƒãƒˆ
                
                // ä¸­å¤®ãƒã‚¹ï¼ˆ2è¡Œç›®ã€2åˆ—ç›®ï¼‰ã«å›ºå®šã™ã‚‹ãŠé¡Œ
                const centerTaskRaw = "ã‚¢ãƒ€ã‚¹ãƒˆãƒªã‚¢ãƒ–ãƒ©ãƒ³ãƒ‰ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’èº«ã«ç€ã‘ã¦ã„ã‚‹";
                const centerTask = centerTaskRaw;
                console.log('ä¸­å¤®ãƒã‚¹ãŠé¡Œï¼ˆå…ƒï¼‰:', centerTaskRaw);
                console.log('ä¸­å¤®ãƒã‚¹ãŠé¡Œï¼ˆå‡¦ç†å¾Œï¼‰:', centerTask);
                
                // ä¸­å¤®ãƒã‚¹ç”¨ã®ãŠé¡Œã‚’é™¤å¤–ã—ãŸãƒªã‚¹ãƒˆã‚’ä½œæˆï¼ˆå…ƒã®ãƒ†ã‚­ã‚¹ãƒˆã§æ¯”è¼ƒï¼‰
                const tasksWithoutCenter = tasks.filter(task => {
                    const cleanTask = task.replace(/<br>/gi, '').trim();
                    return cleanTask !== centerTaskRaw;
                });
                
                // 8ãƒã‚¹åˆ†ã®ãŠé¡ŒãŒå¿…è¦ï¼ˆä¸­å¤®ãƒã‚¹ä»¥å¤–ï¼‰
                if (tasksWithoutCenter.length < 8) {
                    console.warn('ãŠé¡ŒãŒ8å€‹æœªæº€ã§ã™ã€‚8å€‹ä»¥ä¸Šç”¨æ„ã—ã¦ãã ã•ã„ã€‚');
                }
                
                // 8ã¤ã®ãŠé¡Œã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
                const shuffledTasks = shuffle([...tasksWithoutCenter]);
                
                let taskIndex = 0;
                for (let i = 0; i < 3; i++) { // 3è¡Œ
                    const tr = document.createElement('tr');
                    for (let j = 0; j < 3; j++) { // 3åˆ—
                        const td = document.createElement('td');
                        // ä¸­å¤®ãƒã‚¹ï¼ˆi=1, j=1ï¼‰ã®å ´åˆã¯å›ºå®šã®ãŠé¡Œã‚’ä½¿ç”¨
                        let taskText;
                        if (i === 1 && j === 1) {
                            // ä¸­å¤®ãƒã‚¹ã¯å¿…ãšå›ºå®šã®ãŠé¡Œã‚’ä½¿ç”¨
                            taskText = centerTask;
                        } else {
                            // ãã‚Œä»¥å¤–ã®ãƒã‚¹
                            if (taskIndex < shuffledTasks.length) {
                                taskText = shuffledTasks[taskIndex++];
                            } else {
                                // ãŠé¡ŒãŒè¶³ã‚Šãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                                taskText = 'ãŠé¡ŒãŒè¶³ã‚Šã¾ã›ã‚“';
                            }
                        }
                        
                        // aria-labelç”¨ã«<br>ã‚¿ã‚°ã‚’å‰Šé™¤ã—ãŸãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆ
                        const taskTextForAria = taskText.replace(/<br>/g, ' ');
                        
                        // ãƒã‚¹ã®ä¸­èº«ã‚’HTMLã§æ§‹ç¯‰
                        td.innerHTML = `
                            <div class="cell-content">
                                <div class="task">${taskText.replace(/<br>/g, ' ')}</div>
                                <div class="input-placeholder">ã‚¿ãƒƒãƒ—ã—ã¦å…¥åŠ›</div>
                                <div class="achieved-name"></div>
                            </div>
                        `;
                        // ãƒ‡ãƒ¼ã‚¿å±æ€§ã«ãŠé¡Œã‚’ä¿å­˜ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ï¼‰
                        td.setAttribute('data-task', taskTextForAria);
                        td.setAttribute('data-task-html', taskText);
                        tr.appendChild(td);
                    }
                    tbody.appendChild(tr);
                }
            }

            // ç¾åœ¨ç·¨é›†ä¸­ã®ãƒã‚¹ã‚’ä¿å­˜
            let currentCell = null;

            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
            function openModal(cell) {
                currentCell = cell;
                const taskText = cell.getAttribute('data-task');
                const modal = document.getElementById('inputModal');
                const modalTask = document.getElementById('modalTask');
                const modalCompanyInput = document.getElementById('modalCompanyInput');
                const modalNameInput = document.getElementById('modalNameInput');
                
                modalTask.textContent = taskText;
                
                // æ—¢ã«å…¥åŠ›æ¸ˆã¿ã®å ´åˆã¯æ—¢å­˜ã®å€¤ã‚’è¡¨ç¤º
                const nameDisplay = cell.querySelector('.achieved-name');
                if (cell.classList.contains('achieved') && nameDisplay.innerHTML) {
                    // innerHTMLã‹ã‚‰<br>ã‚¿ã‚°ã‚’ã‚¹ãƒšãƒ¼ã‚¹ã«å¤‰æ›ã—ã¦åˆ†å‰²
                    const currentText = nameDisplay.innerHTML.replace(/<br\s*\/?>/gi, '\n');
                    const parts = currentText.split('\n');
                    if (parts.length >= 2) {
                        modalCompanyInput.value = parts[0].trim();
                        modalNameInput.value = parts[1].trim();
                    } else {
                        // æ”¹è¡ŒãŒãªã„å ´åˆã¯æœ€åˆã®ã‚¹ãƒšãƒ¼ã‚¹ã§åˆ†å‰²ã‚’è©¦ã¿ã‚‹
                        const spaceIndex = currentText.indexOf(' ');
                        if (spaceIndex > 0) {
                            modalCompanyInput.value = currentText.substring(0, spaceIndex).trim();
                            modalNameInput.value = currentText.substring(spaceIndex + 1).trim();
                        } else {
                            modalCompanyInput.value = '';
                            modalNameInput.value = currentText.trim();
                        }
                    }
                } else {
                    modalCompanyInput.value = '';
                    modalNameInput.value = '';
                }
                
                modal.classList.add('active');
                // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’ä¼šç¤¾åå…¥åŠ›æ¬„ã«
                setTimeout(() => modalCompanyInput.focus(), 100);
            }

            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«å…¬é–‹ï¼‰
            window.closeModal = function() {
                const modal = document.getElementById('inputModal');
                modal.classList.remove('active');
                currentCell = null;
            };

            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‹ã‚‰é€ä¿¡ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«å…¬é–‹ï¼‰
            window.submitModal = function() {
                if (!currentCell) return;
                
                const modalCompanyInput = document.getElementById('modalCompanyInput');
                const modalNameInput = document.getElementById('modalNameInput');
                const company = modalCompanyInput.value.trim();
                const name = modalNameInput.value.trim();
                
                if (company === '' || name === '') {
                    alert('ä¼šç¤¾åã¨åå‰ã®ä¸¡æ–¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                const nameDisplay = currentCell.querySelector('.achieved-name');
                nameDisplay.innerHTML = `${company}<br>${name}`;
                currentCell.classList.add('achieved');
                closeModal();
            };

            // 4. ãƒã‚¹ã‚¯ãƒªãƒƒã‚¯æ™‚ã«ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
            function setupEventListeners() {
                const bingoBody = document.getElementById('bingo-body');
                
                // ã‚¤ãƒ™ãƒ³ãƒˆå§”ä»»ï¼ˆtbodyå…¨ä½“ã§ã‚¯ãƒªãƒƒã‚¯ã‚’ç›£è¦–ï¼‰
                bingoBody.addEventListener('click', function(e) {
                    // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã®ãŒtdã‹ãã®å­è¦ç´ ã‹åˆ¤å®š
                    const cell = e.target.closest('td');
                    if (cell) {
                        openModal(cell);
                    }
                });
                
                // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®èƒŒæ™¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰é–‰ã˜ã‚‹
                const modal = document.getElementById('inputModal');
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeModal();
                    }
                });
                
                // Enterã‚­ãƒ¼ã§é€ä¿¡ï¼ˆä¼šç¤¾åå…¥åŠ›æ¬„ã‹ã‚‰ï¼‰
                document.getElementById('modalCompanyInput').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        document.getElementById('modalNameInput').focus();
                    }
                });
                
                // Enterã‚­ãƒ¼ã§é€ä¿¡ï¼ˆåå‰å…¥åŠ›æ¬„ã‹ã‚‰ï¼‰
                document.getElementById('modalNameInput').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        submitModal();
                    }
                });
            }

            // --- å®Ÿè¡Œ ---
            createBingoCard();    // ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
            setupEventListeners(); // ãƒœã‚¿ãƒ³ã®ç›£è¦–ã‚’é–‹å§‹
        });
    </script>

</body>
</html>

